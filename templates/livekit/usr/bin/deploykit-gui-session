#!/bin/bash

# Start a "minimal session" for DeployKit, before launching MATE.
feh --bg-fill /usr/share/backgrounds/livekit.jpg
start-pulseaudio-x11 &
marco &
fcitx &
alsactl init &
# Disable X screen saver (blanking).
xset s off &
# Set volume to a lower value.
pactl set-sink-volume '@DEFAULT_SINK@' '60%'

# Wait for the Window Manager to fully initialize.
while true ; do
	sleep 1
	if xprop -root | grep -q _NET_SUPPORTING_WM_CHECK ; then
		break
	fi
done
sleep 1

env WEBKIT_DISABLE_DMABUF_RENDERER=1 deploykit-gui -d /usr/share/deploykit-gui/bgm

# Process clean-up.
killall marco fcitx alsactl pulseaudio

# Source the language setting that we have just set.
source /etc/locale.conf

# After "exiting" DeployKit (by selecting "Rescue & Recovery"), launch a full
# MATE desktop session.
mate-session
